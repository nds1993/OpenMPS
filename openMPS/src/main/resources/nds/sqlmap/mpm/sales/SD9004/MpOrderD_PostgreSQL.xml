<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="SD9004MpOrderD">
	
	<typeAlias  alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
	<typeAlias  alias="SD9004MpOrderHSerarchVO" type="nds.mpm.sales.SD0405.vo.MpOrderHVO"/>
	
	<sql id="selectWhere_fragment">
			FROM 
			openmps.mp_order_h a
			inner join openmps.mp_order_d d on (a.corp_code = d.corp_code 
									and a.delv_date = d.delv_date 
									and a.ordr_no = d.ordr_no)
			left outer join openmps."FN_GET_WMSJAEGO"('1000',a.corp_code,a.delv_date, a.delv_dc,d.pro_code) 
			stok on (1=1)
			WHERE a.corp_code=#corpCode#
				AND a.delv_date=#delvDate#
				AND a.ordr_cust=#ordrCust#
		<dynamic > 
	         <isNotEmpty prepend="and" property="delvCust">
			 a.delv_cust = #delvCust#
	         </isNotEmpty>
	         <isNotEmpty prepend="and" property="limitYn">
			 and a.limit_yn = #limitYn#
	         </isNotEmpty>
		</dynamic>
	</sql>
	<select id="SD9004MpOrderDDAO.selectMpOrderDList_D" parameterClass="SD9004MpOrderHSerarchVO" resultClass="egovMap">
		SELECT
				d.corp_code
				, a.ordr_cust
				, openmps."FN_GET_CUSTCODENM"(a.corp_code,a.ordr_cust) as ordr_custname 
				, d.delv_date
				, d.ordr_no
				, d.ordr_seq
				, d.pro_code
				, openmps."FN_GET_PROCODENM"(a.corp_code,d.pro_code) as pro_name
				, d.unit_price
				, d.ordr_box
				, d.ordr_weight
				, d.ordr_amt
				, stok.cur_stokqty stock_box <!--  현재고	-->
		<include refid="selectWhere_fragment"/>
	</select>	
	<select id="SD9004MpOrderDDAO.selectMpOrderDListTotCnt_S" parameterClass="SD9004MpOrderHSerarchVO" resultClass="int">
		select count(*)
		<include refid="selectWhere_fragment"/>
	</select>

</sqlMap>
