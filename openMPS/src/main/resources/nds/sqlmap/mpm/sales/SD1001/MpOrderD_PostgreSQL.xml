<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="SD1001MpOrderD">
	
	<typeAlias  alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
	<typeAlias  alias="SD1001MpOrderHSerarchVO" type="nds.mpm.sales.SD0405.vo.MpOrderHVO"/>
	
	<sql id="selectWhere_fragment">
			FROM 
			openmps.mp_order_h a
			inner join openmps.mp_order_d d on (a.corp_code = d.corp_code 
									and a.delv_date = d.delv_date 
									and a.ordr_no = d.ordr_no)
			WHERE a.corp_code=#corpCode#
				AND a.delv_date between #strtDate# and #lastDate#
				AND a.ordr_cust=#ordrCust#
		<dynamic > 
	         <isNotEmpty prepend="and" property="delvCust">
	         </isNotEmpty>
		</dynamic>
	</sql>
	<select id="SD1001MpOrderDDAO.selectMpOrderHeadList_D" parameterClass="SD1001MpOrderHSerarchVO" resultClass="egovMap">
		SELECT
				a.corp_code
				, a.ordr_cust
				, a.ordr_type
				, openmps."FN_GET_TMCODEXDNM"(a.corp_code,'SD017',a.ordr_type) as ordr_type_name
				, a.delv_date
				, a.ordr_no
				, sum(d.ordr_box) ordr_box
				, sum(d.ordr_weight) ordr_weight
				, sum(d.ordr_amt) ordr_amt
				, sum(d.ordr_vat) ordr_vat
				, (sum(d.ordr_amt) +  sum(d.ordr_vat)) ordr_amt_sum
		<include refid="selectWhere_fragment"/>
		group by a.corp_code
				, a.delv_date
				, a.ordr_no
				, a.ordr_cust
				, a.ordr_type
	</select>	
	<select id="SD1001MpOrderDDAO.selectMpOrderHeadListTotCnt_S" parameterClass="SD1001MpOrderHSerarchVO" resultClass="int">
		select count(*)
		<include refid="selectWhere_fragment"/>
	</select>
	
	<select id="SD1001MpOrderDDAO.selectMpOrderDetailList_D" parameterClass="SD1001MpOrderHSerarchVO" resultClass="egovMap">
		SELECT
				d.corp_code
				, h.ordr_cust
				, h.ordr_type
				, h.amt_display
				, h.limit_yn
				, d.delv_date
				, d.ordr_no
				, d.ordr_seq
				, d.pro_code
				, openmps."FN_GET_PROCODENM"(d.corp_code,d.pro_code) as pro_name
				, d.unit_price
				, d.ordr_box
				, d.ordr_weight
				, d.ordr_amt
				, d.ordr_vat
				, (d.ordr_amt + d.ordr_vat) ordr_sum
		<include refid="selectWhere_fragment"/>
		order by d.delv_date
				, d.ordr_no
	</select>	

</sqlMap>
