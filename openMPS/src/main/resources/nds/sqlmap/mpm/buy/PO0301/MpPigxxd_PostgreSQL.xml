<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="PO0301MpPigxxd">
	
	<typeAlias  alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
	<typeAlias  alias="PO0301MpPigxxdSerarchVO" type="nds.mpm.buy.PO0301.vo.MpPigxxdVO"/>
	
	<resultMap id="PO0301MpPigxxd" class="nds.mpm.buy.PO0301.vo.MpPigxxdVO">
		<result property="corpCode" column="corp_code" columnIndex="1"/>
		<result property="dochDate" column="doch_date" columnIndex="2"/>
		<result property="procDate" column="proc_date" columnIndex="3"/>
		<result property="custCode" column="cust_code" columnIndex="4"/>
		<result property="partGubn" column="part_gubn" columnIndex="5"/>
		<result property="brandCode" column="brand_code" columnIndex="6"/>
		<result property="dochCnt" column="doch_cnt" columnIndex="7"/>
		<result property="deduAmt" column="dedu_amt" columnIndex="8"/>
		<result property="setlAmt" column="setl_amt" columnIndex="9"/>
		<result property="scraMeat" column="scra_meat" columnIndex="10"/>
		<result property="scraAmt" column="scra_amt" columnIndex="11"/>
		<result property="pigWeig" column="pig_weig" columnIndex="12"/>
		<result property="dispRate" column="disp_rate" columnIndex="13"/>
		<result property="othMeat" column="oth_meat" columnIndex="14"/>
		<result property="othAmt" column="oth_amt" columnIndex="15"/>
		<result property="cuseOccur" column="cuse_occur" columnIndex="16"/>
		<result property="occurQty" column="occur_qty" columnIndex="17"/>
		<result property="hindLeg" column="hind_leg" columnIndex="18"/>
		<result property="memo" column="memo" columnIndex="19"/>
		<result property="deleYn" column="dele_yn" columnIndex="20"/>
		<result property="mdUser" column="md_user" columnIndex="21"/>
		<result property="mdDate" column="md_date" columnIndex="22"/>
		<result property="crUser" column="cr_user" columnIndex="23"/>
		<result property="crDate" column="cr_date" columnIndex="24"/>
	</resultMap>
	
	<insert id="PO0301MpPigxxdDAO.insertMpPigxxd">
		<selectKey resultClass="java.lang.String" keyProperty="custCode">
          <![CDATA[
            SELECT #custCode# 
          ]]>
      	</selectKey>
		<![CDATA[
			INSERT INTO mp_pigxxd 
				( corp_code
				  , doch_date
				  , proc_date
				  , cust_code
				  , part_gubn
				  , brand_code
				  , doch_cnt
				  , dedu_amt
				  , setl_amt
				  , scra_meat
				  , scra_amt
				  , pig_weig
				  , disp_rate
				  , oth_meat
				  , oth_amt
				  , cuse_occur
				  , occur_qty
				  , hind_leg
				  , memo
				  , dele_yn
				  , md_user
				  , md_date
				  , cr_user
				  , cr_date )
			VALUES ( #corpCode#
				  , #dochDate#
				  , #procDate#
				  , #custCode#
				  , #partGubn#
				  , #brandCode#
				  , #dochCnt#
				  , #deduAmt#
				  , #setlAmt#
				  , #scraMeat#
				  , #scraAmt#
				  , #pigWeig#
				  , #dispRate#
				  , #othMeat#
				  , #othAmt#
				  , #cuseOccur#
				  , #occurQty#
				  , #hindLeg#
				  , #memo#
				  , #deleYn#
				  , #mdUser#
				  , #mdDate#
				  , #crUser#
				  , #crDate# )
			ON CONFLICT (corp_code, doch_date, proc_date, cust_code, part_gubn)
    		DO UPDATE SET	
    			 brand_code=#brandCode#
				, doch_cnt=#dochCnt#
				, dedu_amt=#deduAmt#
				, setl_amt=#setlAmt#
				, scra_meat=#scraMeat#
				, scra_amt=#scraAmt#
				, pig_weig=#pigWeig#
				, disp_rate=#dispRate#
				, oth_meat=#othMeat#
				, oth_amt=#othAmt#
				, cuse_occur=#cuseOccur#
				, occur_qty=#occurQty#
				, hind_leg=#hindLeg#
				, memo=#memo#
				, md_user=#mdUser#
				, md_date=now()
		]]>
	</insert>
	
	<update id="PO0301MpPigxxdDAO.updateMpPigxxd">
		<![CDATA[
			UPDATE mp_pigxxd
			SET brand_code=#brandCode#
				, doch_cnt=#dochCnt#
				, dedu_amt=#deduAmt#
				, setl_amt=#setlAmt#
				, scra_meat=#scraMeat#
				, scra_amt=#scraAmt#
				, pig_weig=#pigWeig#
				, disp_rate=#dispRate#
				, oth_meat=#othMeat#
				, oth_amt=#othAmt#
				, cuse_occur=#cuseOccur#
				, occur_qty=#occurQty#
				, hind_leg=#hindLeg#
				, memo=#memo#
				, md_user=#mdUser#
				, md_date=now()
						WHERE corp_code=#corpCode#
								AND doch_date=#dochDate#
								AND proc_date=#procDate#
								AND cust_code=#custCode#
								AND part_gubn=#partGubn#
				]]>
	</update>
	
	<delete id="PO0301MpPigxxdDAO.deleteMpPigxxd">
		<![CDATA[
			update mp_pigxxd set dele_yn = 'Y' 
						, md_user=#mdUser#
						, md_date=now()
						WHERE corp_code=#corpCode#
								AND doch_date=#dochDate#
								AND proc_date=#procDate#
								AND cust_code=#custCode#
								AND part_gubn=#partGubn#
				]]>
	</delete>
	
	<select id="PO0301MpPigxxdDAO.selectMpPigxxd_S" resultMap="PO0301MpPigxxd">
		<![CDATA[
			SELECT
				corp_code
				, doch_date
				, proc_date
				, cust_code
				, part_gubn
				, brand_code
				, doch_cnt
				, dedu_amt
				, setl_amt
				, scra_meat
				, scra_amt
				, pig_weig
				, disp_rate
				, oth_meat
				, oth_amt
				, cuse_occur
				, occur_qty
				, hind_leg
				, memo
				, dele_yn
				, md_user
				, md_date
				, cr_user
				, cr_date
			FROM mp_pigxxd
						WHERE corp_code=#corpCode#
								AND doch_date=#dochDate#
								AND proc_date=#procDate#
								AND cust_code=#custCode#
								AND part_gubn=#partGubn#
				]]>
	</select>
	<sql id="selectWhere_fragment">
		FROM openmps.mp_pigxxd a
		where corp_code=#corpCode#
		and doch_date =#dochDate#
		and dele_yn = 'N'
		<dynamic>
			<isNotEmpty property="custCode">
				and a.cust_code = #custCode#
			</isNotEmpty>
			<isNotEmpty property="brandCode">
				and a.brand_code = #brandCode#
			</isNotEmpty>
		</dynamic>
	</sql>
	<select id="PO0301MpPigxxdDAO.selectMpPigxxdList_D" parameterClass="PO0301MpPigxxdSerarchVO" resultClass="egovMap">
		SELECT
				corp_code
				, doch_date
				, proc_date
				, cust_code
				, openmps."FN_GET_CUSTCODENM"(a.corp_code,a.cust_code) as cust_name
				, openmps."FN_GET_TMCODEXDNM"(a.corp_code,'PP006',a.buy_type) as buy_type_name
				, openmps."FN_GET_TMCODEXDNM"(a.corp_code,'PP007',a.brand_code) as brand_code_name
				, doch_cnt
				, dedu_amt
				, setl_amt
				, part_gubn
				, scra_meat
				, scra_amt
				, pig_weig
				, disp_rate
				, oth_meat
				, oth_amt
				, cuse_occur
				, occur_qty
				, hind_leg
				, memo
				, brand_code
		<include refid="selectWhere_fragment"/>		
	</select>	
	<select id="PO0301MpPigxxdDAO.selectMpPigxxdListTotCnt_S" parameterClass="PO0301MpPigxxdSerarchVO" resultClass="int">
		select count(*)
		<include refid="selectWhere_fragment"/>		
	</select>

</sqlMap>
