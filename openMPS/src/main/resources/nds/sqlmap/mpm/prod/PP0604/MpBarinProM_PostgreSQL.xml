<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="MpBarinProM">
	
	<typeAlias  alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
	<typeAlias  alias="mpBarinProMSerarchVO" type="nds.mpm.prod.PP0604.vo.MpBarinProMDefaultVO"/>
	
	<resultMap id="mpBarinProM" class="nds.mpm.prod.PP0604.vo.MpBarinProMVO">
		<result property="corpCode" column="corp_code" columnIndex="1"/>
		<result property="plantCode" column="plant_code" columnIndex="2"/>
		<result property="barinCode" column="barin_code" columnIndex="3"/>
		<result property="proCode" column="pro_code" columnIndex="4"/>
		<result property="barinDate" column="barin_date" columnIndex="5"/>
		<result property="barinNo" column="barin_no" columnIndex="6"/>
		<result property="weight" column="weight" columnIndex="7"/>
		<result property="proDate" column="pro_date" columnIndex="8"/>
		<result property="bunchNo" column="bunch_no" columnIndex="9"/>
		<result property="slaughterhouse" column="slaughterhouse" columnIndex="10"/>
		<result property="shelfLife" column="shelf_life" columnIndex="11"/>
		<result property="barinTime" column="barin_time" columnIndex="12"/>
		<result property="gita1" column="gita1" columnIndex="13"/>
		<result property="gita2" column="gita2" columnIndex="14"/>
		<result property="gita3" column="gita3" columnIndex="15"/>
		<result property="gita4" column="gita4" columnIndex="16"/>
		<result property="gita5" column="gita5" columnIndex="17"/>
		<result property="gita6" column="gita6" columnIndex="18"/>
		<result property="gita7" column="gita7" columnIndex="19"/>
		<result property="memo" column="memo" columnIndex="20"/>
		<result property="deleYn" column="dele_yn" columnIndex="21"/>
		<result property="mdDate" column="md_date" columnIndex="22"/>
		<result property="crDate" column="cr_date" columnIndex="23"/>
	</resultMap>
	
	<insert id="mpBarinProMDAO.insertMpBarinProM_S">
		<![CDATA[
			INSERT INTO mp_barin_pro_m 
				( corp_code
				  , plant_code
				  , barin_code
				  , pro_code
				  , barin_date
				  , barin_no
				  , weight
				  , pro_date
				  , bunch_no
				  , slaughterhouse
				  , shelf_life
				  , barin_time
				  , gita1
				  , gita2
				  , gita3
				  , gita4
				  , gita5
				  , gita6
				  , gita7
				  , memo
				  , dele_yn
				  , md_date
				  , cr_date )
			VALUES ( #corpCode#
				  , #plantCode#
				  , #barinCode#
				  , #proCode#
				  , #barinDate#
				  , #barinNo#
				  , #weight#
				  , #proDate#
				  , #bunchNo#
				  , #slaughterhouse#
				  , #shelfLife#
				  , #barinTime#
				  , #gita1#
				  , #gita2#
				  , #gita3#
				  , #gita4#
				  , #gita5#
				  , #gita6#
				  , #gita7#
				  , #memo#
				  , #deleYn#
				  , #mdDate#
				  , #crDate# )
		]]>
	</insert>
	
	<update id="mpBarinProMDAO.updateMpBarinProM_S">
		<![CDATA[
			UPDATE mp_barin_pro_m
			SET corp_code=#corpCode#
				, plant_code=#plantCode#
				, barin_code=#barinCode#
				, pro_code=#proCode#
				, barin_date=#barinDate#
				, barin_no=#barinNo#
				, weight=#weight#
				, pro_date=#proDate#
				, bunch_no=#bunchNo#
				, slaughterhouse=#slaughterhouse#
				, shelf_life=#shelfLife#
				, barin_time=#barinTime#
				, gita1=#gita1#
				, gita2=#gita2#
				, gita3=#gita3#
				, gita4=#gita4#
				, gita5=#gita5#
				, gita6=#gita6#
				, gita7=#gita7#
				, memo=#memo#
				, dele_yn=#deleYn#
				, md_date=#mdDate#
				, cr_date=#crDate#
						WHERE corp_code=#corpCode#
								AND plant_code=#plantCode#
								AND barin_code=#barinCode#
								AND pro_code=#proCode#
				]]>
	</update>
	
	<delete id="mpBarinProMDAO.deleteMpBarinProM_S">
		<![CDATA[
			DELETE FROM mp_barin_pro_m 
						WHERE corp_code=#corpCode#
								AND plant_code=#plantCode#
								AND barin_code=#barinCode#
								AND pro_code=#proCode#
				]]>
	</delete>
	
	<select id="mpBarinProMDAO.selectMpBarinProM_S" resultMap="mpBarinProM">
		<![CDATA[
			SELECT
				corp_code
				, plant_code
				, barin_code
				, pro_code
				, barin_date
				, barin_no
				, weight
				, pro_date
				, bunch_no
				, slaughterhouse
				, shelf_life
				, barin_time
				, gita1
				, gita2
				, gita3
				, gita4
				, gita5
				, gita6
				, gita7
				, memo
				, dele_yn
				, md_date
				, cr_date
			FROM mp_barin_pro_m
						WHERE corp_code=#corpCode#
								AND plant_code=#plantCode#
								AND barin_code=#barinCode#
								AND pro_code=#proCode#
				]]>
	</select>
	
	<select id="mpBarinProMDAO.selectMpBarinProMList_D" parameterClass="mpBarinProMSerarchVO" resultClass="egovMap">
	SELECT c.plant_name,
	       MAX(a.bunch_no) AS bunch_no,
	       a.pro_code,
	       b.pro_name,
	       SUM(prodcnt) AS barin_qty,
	       SUM(planqty) AS pro_qty_plan
	  FROM (SELECT a.corp_code,
	               a.plant_code,
	               a.pro_code,
	               a.bunch_no,
	               COUNT(*) AS prodcnt,
	               0 AS planqty
	          FROM openmps.mp_barin_pro_m a
	         WHERE a.barin_date = #strtDate#
	           AND a.corp_code = #corpCode#
	           <isNotEmpty property="plantCode">
	           AND a.plant_code = #plantCode#
	           </isNotEmpty>
	           <isNotEmpty property="proCode">
	           AND a.pro_code = #proCode#
	           </isNotEmpty>
	           AND a.dele_yn = 'N'
	         GROUP BY a.corp_code, a.plant_code, a.pro_code, a.bunch_no
	        UNION ALL
	        SELECT a.corp_code, a.plant_code, a.pro_code, '', 0, a.san_qty * a.ipsu_doo
	          FROM openmps.mp_plan_cm_d a
	         WHERE a.work_date = #strtDate#
	           AND a.corp_code = #corpCode#
	          <isNotEmpty property="plantCode">
	           AND a.plant_code = #plantCode#
	           </isNotEmpty>
	           <isNotEmpty property="proCode">
	           AND a.pro_code = #proCode#
	           </isNotEmpty>
	           AND NOT (a.san_qty IS NULL OR a.san_qty = 0)) a,
	       openmps.mp_item_master_m b,
	       openmps.tm_platxm c
	 WHERE a.pro_code = b.pro_code
	   AND a.corp_code = b.corp_code
	   AND a.plant_code = c.plant_code
	   AND a.corp_code = c.corp_code
	 GROUP BY c.plant_name, a.pro_code, b.pro_name
	</select>	

</sqlMap>
