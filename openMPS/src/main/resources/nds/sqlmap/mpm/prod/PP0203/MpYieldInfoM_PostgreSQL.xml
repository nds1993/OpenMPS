<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="PP0203MpYieldInfoM">
	
	<typeAlias  alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
	<typeAlias  alias="PP0203mpYieldInfoMSerarchVO" type="nds.mpm.prod.PP0201.vo.MpYieldInfoMVO"/>
	
	<select id="PP0203mpYieldInfoMDAO.selectMpYieldInfoMList_T" parameterClass="PP0203mpYieldInfoMSerarchVO" resultClass="egovMap">
	<![CDATA[
	SELECT CASE
	          WHEN no = 1 THEN           '가공두수'
	          WHEN no = 2 THEN           '생체중량'
	          WHEN no = 3 THEN           '지육중량'
	          WHEN no = 4 THEN           '지육율'
	          WHEN no = 5 THEN           ''
	        END col1,
	       CASE
	          WHEN no = 1 THEN           cur_suyul_dusu
	          WHEN no = 2 THEN           cur_suyul_wei1
	          WHEN no = 3 THEN           cur_suyul_wei2
	          WHEN no = 4 THEN           cur_a
	          WHEN no = 5 THEN           ''
	        END col2,
	       CASE
	          WHEN no = 1 THEN           '정육율'
	          WHEN no = 2 THEN           '부산물율'
	          WHEN no = 3 THEN           '감량율'
	          WHEN no = 4 THEN           '평균지육중량'
	          WHEN no = 5 THEN           '평균생체중량'
	        END col3,
	       CASE
	          WHEN no = 1 THEN           cur_b
	          WHEN no = 2 THEN           cur_c
	          WHEN no = 3 THEN           cur_d
	          WHEN no = 4 THEN           cur_e
	          WHEN no = 5 THEN           cur_f
	        END col4,
	        CASE
	          WHEN no = 1 THEN           '가공두수'
	          WHEN no = 2 THEN           '생체중량'
	          WHEN no = 3 THEN           '지육중량'
	          WHEN no = 4 THEN           '지육율'
	          WHEN no = 5 THEN           ''
	        END col5,
	       CASE
	          WHEN no = 1 THEN           sum_suyul_dusu
	          WHEN no = 2 THEN           sum_suyul_wei1
	          WHEN no = 3 THEN           sum_suyul_wei2
	          WHEN no = 4 THEN           sum_a
	          WHEN no = 5 THEN           ''
	        END col6,
	       CASE
	          WHEN no = 1 THEN           '정육율'
	          WHEN no = 2 THEN           '부산물율'
	          WHEN no = 3 THEN           '감량율'
	          WHEN no = 4 THEN           '평균지육중량'
	          WHEN no = 5 THEN           '평균생체중량'
	        END col7,
	       CASE
	          WHEN no = 1 THEN           sum_b
	          WHEN no = 2 THEN           sum_c
	          WHEN no = 3 THEN           sum_d
	          WHEN no = 4 THEN           sum_e
	          WHEN no = 5 THEN           sum_f
	        END col8      		        
	  FROM (SELECT to_char(SUM(suyul_dusu), '999,999,999') AS cur_suyul_dusu,   
	               to_char(SUM(suyul_wei1), '999,999,999') AS cur_suyul_wei1,   
	               to_char(SUM(suyul_wei2), '999,999,999') AS cur_suyul_wei2,                  
	               to_char(SUM(suyul_wei2) / SUM(suyul_wei1) * 100, '990D99') AS cur_a,    
	               to_char(MAX(weig) / SUM(suyul_wei2) * 100, '990D99') AS cur_b,  
	               to_char(MAX(b_weig) / SUM(suyul_wei2) * 100, '990D99') AS cur_c,              
	               to_char((SUM(suyul_wei2)-MAX(d_weig)) / SUM(suyul_wei2) * 100, '990D99') AS cur_d,                  
	               to_char(SUM(suyul_wei2)/SUM(suyul_dusu), '999,999,999') AS cur_e, 
	               to_char(SUM(suyul_wei1)/SUM(suyul_dusu), '999,999,999') AS cur_f   
	          FROM openmps.mp_yield_info_m a,
	               (SELECT SUM(a.box_weig) weig
	                  FROM openmps.mp_bar_pro_m a, openmps.mp_item_master_m b
	                 WHERE 1 = 1
	                   AND a.corp_code = b.corp_code
	                   AND a.pro_code = b.pro_code
	                   AND b.meat_type = '1'
	                   AND a.dele_yn = 'N'
	                   AND a.prdt_type = '1'  
	                   AND a.corp_code = #corpCode#
	                   AND a.pro_date BETWEEN #junStrtDate# AND #junLastDateBe# 
	                   AND a.plant_code IN (SELECT plant_code
	                                          FROM openmps.tm_platxm a
	                                         WHERE a.grup_plant = #grupPlant#
	                                           AND a.prdt_type = '1'  
	                                           AND a.corp_code = #corpCode#)) b,
	               (SELECT SUM(a.box_weig) b_weig
	                  FROM openmps.mp_bar_pro_m a, openmps.mp_item_master_m b
	                 WHERE 1 = 1
	                   AND a.corp_code = b.corp_code
	                   AND a.pro_code = b.pro_code
	                   AND b.meat_type = '2'
	                   AND a.dele_yn = 'N'
	                   AND a.prdt_type = '1'  
	                   AND a.corp_code = #corpCode#
	                   AND a.pro_date BETWEEN #junStrtDate# AND #junLastDateBe#  
	                   AND a.plant_code IN (SELECT plant_code
	                                          FROM openmps.tm_platxm a
	                                         WHERE a.grup_plant = #grupPlant#
	                                           AND a.prdt_type = '1'  
	                                           AND a.corp_code = #corpCode#)) c,                                           
	               (SELECT SUM(a.box_weig) d_weig
	                  FROM openmps.mp_bar_pro_m a, openmps.mp_item_master_m b
	                 WHERE 1 = 1
	                   AND a.corp_code = b.corp_code
	                   AND a.pro_code = b.pro_code
	                   AND a.dele_yn = 'N'
	                   AND a.prdt_type = '1'  
	                   AND a.corp_code = #corpCode#
	                   AND a.pro_date BETWEEN #junStrtDate# AND #junLastDateBe#  
	                   AND a.plant_code IN (SELECT plant_code
	                                          FROM openmps.tm_platxm a
	                                         WHERE a.grup_plant = #grupPlant#
	                                           AND a.prdt_type = '1'  
	                                           AND a.corp_code = #corpCode#)) d
	         WHERE a.corp_code = #corpCode#
	           AND a.work_date BETWEEN #junStrtDate# AND #junLastDateBe#  
	           AND a.grup_plant = #grupPlant#  
	        ) as a,
	       (SELECT to_char(SUM(suyul_dusu), '999,999,999') AS sum_suyul_dusu, 
	               to_char(SUM(suyul_wei1), '999,999,999') AS sum_suyul_wei1,   
	               to_char(SUM(suyul_wei2), '999,999,999') AS sum_suyul_wei2,                  
	               to_char(SUM(suyul_wei2) / SUM(suyul_wei1) * 100, '990D99') AS sum_a,   
	               to_char(MAX(weig) / SUM(suyul_wei2) * 100, '990D99') AS sum_b,   
	               to_char(MAX(b_weig) / SUM(suyul_wei2) * 100, '990D99') AS sum_c,   
	               to_char((SUM(suyul_wei2)-MAX(d_weig)) / SUM(suyul_wei2) * 100, '990D99') AS sum_d, 
	               to_char(SUM(suyul_wei2)/SUM(suyul_dusu), '999,999,999') AS sum_e, 
	               to_char(SUM(suyul_wei1)/SUM(suyul_dusu), '999,999,999') AS sum_f                  
	          FROM openmps.mp_yield_info_m a,
	               (SELECT SUM(a.box_weig) weig
	                  FROM openmps.mp_bar_pro_m a, openmps.mp_item_master_m b
	                 WHERE 1 = 1
	                   AND a.corp_code = b.corp_code
	                   AND a.pro_code = b.pro_code
	                   AND b.meat_type = '1'
	                   AND a.dele_yn = 'N'
	                   AND a.prdt_type = '1'  
	                   AND a.corp_code = #corpCode#
	                   AND a.pro_date BETWEEN #dangStrtDateNo# AND #dangLastDateNo#  
							 AND a.plant_code IN (SELECT plant_code
	                                          FROM openmps.tm_platxm a
	                                         WHERE a.grup_plant = #grupPlant#
	                                           AND a.prdt_type = '1'  
	                                           AND a.corp_code = #corpCode#)) b,
	               (SELECT SUM(a.box_weig) b_weig
	                  FROM openmps.mp_bar_pro_m a, openmps.mp_item_master_m b
	                 WHERE 1 = 1
	                   AND a.corp_code = b.corp_code
	                   AND a.pro_code = b.pro_code
	                   AND b.meat_type = '2'
	                   AND a.dele_yn = 'N'
	                   AND a.prdt_type = '1'  
	                   AND a.corp_code = #corpCode#
	                   AND a.pro_date BETWEEN #dangStrtDateNo# AND #dangLastDateNo#  
							 AND a.plant_code IN (SELECT plant_code
	                                          FROM openmps.tm_platxm a
	                                         WHERE a.grup_plant = #grupPlant#
	                                           AND a.prdt_type = '1'  
	                                           AND a.corp_code = #corpCode#)) c,                                           
	               (SELECT SUM(a.box_weig) d_weig
	                  FROM openmps.mp_bar_pro_m a, openmps.mp_item_master_m b
	                 WHERE 1 = 1
	                   AND a.corp_code = b.corp_code
	                   AND a.pro_code = b.pro_code
	                   AND a.dele_yn = 'N'
	                   AND a.prdt_type = '1'  
	                   AND a.corp_code = #corpCode#
	                   AND a.pro_date BETWEEN #dangStrtDateNo# AND #dangLastDateNo#  
							 AND a.plant_code IN (SELECT plant_code
	                                          FROM openmps.tm_platxm a
	                                         WHERE a.grup_plant = #grupPlant#
	                                           AND a.prdt_type = '1' 
	                                           AND a.corp_code = #corpCode#)) d
	         WHERE a.corp_code = #grupPlant#
	           AND a.work_date BETWEEN #dangStrtDateNo# AND #dangLastDateNo# 
				  AND a.grup_plant = #grupPlant#  
	        ) as b,
	       (SELECT 1 AS no
	        UNION ALL
	        SELECT 2
	        UNION ALL
	        SELECT 3
	        UNION ALL
	        SELECT 4
	        UNION ALL
	        SELECT 5) as c	
	]]>	
	</select>	
	
	<select id="PP0203mpYieldInfoMDAO.selectMpYieldInfoMList_L" parameterClass="PP0203mpYieldInfoMSerarchVO" resultClass="egovMap">
	<![CDATA[
	SELECT CASE
	          WHEN a.meat_type IS NULL THEN
	           99
	          ELSE
	           CASE
	          WHEN a.large_code IS NULL THEN
	           88
	          ELSE
	           1
	        END END AS ordering,
	       a.meat_type,
	       CASE
	          WHEN d.code_name IS NULL THEN
	           '합계'
	          ELSE
	           d.code_name
	        END AS meat,
	       a.large_code,
	       CASE
	          WHEN e.code_name IS NULL THEN
	           '소계'
	          ELSE
	           e.code_name
	        END AS large_name,            
	       a.cur_weig AS cur_weig,
	       a.cur_qty AS cur_qty,
	       to_char(a.cur_weig / cur_suyul_wei2 * 100, '990D99') AS cur_rate,
	       a.sum_weig AS sum_weig,
	       a.sum_qty AS sum_qty,
	       to_char(a.sum_weig / sum_suyul_wei2 * 100, '990D99') AS sum_rate
	  FROM (SELECT a.meat_type AS meat_type,
	               a.large_code AS large_code,
	               SUM(a.cur_weig) AS cur_weig,
	               SUM(a.cur_qty) AS cur_qty,
	               SUM(a.sum_weig) AS sum_weig,
	               SUM(a.sum_qty) AS sum_qty
	          FROM (SELECT b.meat_type AS meat_type,
	                       b.large_code AS large_code,
	                       a.box_weig AS cur_weig,
	                       1 AS cur_qty,
	                       0 AS sum_weig,
	                       0 AS sum_qty
	                  FROM openmps.mp_bar_pro_m a, openmps.mp_item_master_m b
	                 WHERE 1 = 1
	                   AND a.corp_code = b.corp_code
	                   AND a.pro_code = b.pro_code
	                      
	                   AND a.dele_yn = 'N'
	                   AND a.prdt_type = '1'  
	                   AND a.corp_code = #corpCode#
	                   AND a.pro_date BETWEEN #junStrtDate# AND #junLastDateBe#  
	                   AND a.plant_code IN (SELECT plant_code
	                                          FROM openmps.tm_platxm a
	                                         WHERE a.grup_plant = #grupPlant#
	                                           AND a.prdt_type = '1'
	                                           AND a.corp_code = #corpCode#)
	                UNION ALL
	                SELECT b.meat_type AS meat_type,
	                       b.large_code AS large_code,
	                       0 AS cur_weig,
	                       0 AS cur_qty,
	                       a.box_weig AS sum_weig,
	                       1 AS sum_qty
	                  FROM openmps.mp_bar_pro_m a, openmps.mp_item_master_m b
	                 WHERE 1 = 1
	                   AND a.corp_code = b.corp_code
	                   AND a.pro_code = b.pro_code
	                      
	                   AND a.dele_yn = 'N'
	                   AND a.prdt_type = '1'  
	                   AND a.corp_code = #corpCode#
	                   AND a.pro_date BETWEEN #dangStrtDateNo# AND #dangLastDateNo# 
							 AND a.plant_code IN (SELECT plant_code
	                                          FROM openmps.tm_platxm a
	                                         WHERE a.grup_plant = #grupPlant#
	                                           AND a.prdt_type = '1'
	                                           AND a.corp_code = #corpCode#)) AS a
	         GROUP BY  (a.meat_type, a.large_code)) AS a
	  LEFT JOIN openmps.tm_codexd d ON a.meat_type = d.code_id
	                              AND d.corp_code = #corpCode#
	                              AND d.group_code = 'MP010'
	  LEFT JOIN openmps.tm_codexd e ON a.large_code = e.code_id
	                              AND e.corp_code = #corpCode#
	                              AND e.group_code = 'MP006',
	 (SELECT SUM(suyul_wei2) AS cur_suyul_wei2,  
		      SUM(suyul_dusu) AS cur_suyul_dusu 
		 FROM openmps.mp_yield_info_m a
		WHERE a.corp_code = #corpCode#
		  AND a.work_date BETWEEN #junStrtDate# AND #junLastDateBe#  
		  AND a.grup_plant = #grupPlant#) AS f,
	 (SELECT SUM(suyul_wei2) AS sum_suyul_wei2,  
	         SUM(suyul_dusu) AS sum_suyul_dusu  
	    FROM openmps.mp_yield_info_m a
	   WHERE a.corp_code = #corpCode#
	     AND a.work_date BETWEEN #dangStrtDateNo# AND #dangLastDateNo# 
		  AND a.grup_plant = #grupPlant#) AS g
	 
	 ORDER BY 1, 2, 4, 6			
	]]>	
	</select>	
	
	<select id="PP0203mpYieldInfoMDAO.selectMpYieldInfoMList_S" parameterClass="PP0203mpYieldInfoMSerarchVO" resultClass="egovMap">
	<![CDATA[
	SELECT CASE
	          WHEN a.meat_type IS NULL THEN
	           99
	          ELSE
	           CASE
	          WHEN a.large_code IS NULL THEN
	           88
	          ELSE
	           1
	        END END AS ordering,
	       a.meat_type,
	       CASE
	          WHEN d.code_name IS NULL THEN
	           '합계'
	          ELSE
	           d.code_name
	        END AS meat,
	       a.large_code,
	       e.code_name AS large_name,
	       a.pro_name AS pro_ordering,
	       CASE
	          WHEN a.pro_name IS NULL THEN
	           CASE
	          WHEN a.large_code IS NULL THEN
	           NULL
	          ELSE
	           '소계'
	        END ELSE a.pro_name END AS pro_name,
	       a.cur_weig AS cur_weig,
	       a.cur_qty AS cur_qty,
	       CASE
	          WHEN pro_name IS NULL THEN
	           to_char(a.cur_weig / cur_suyul_wei2 * 100, '990D99')
	          ELSE
	           CASE
	          WHEN b.cur_weig <> 0 THEN
	           to_char(a.cur_weig / b.cur_weig * 100, '990D99')
	        END END AS cur_rate,
	       a.sum_weig AS sum_weig,
	       a.sum_qty AS sum_qty,
	       CASE
	          WHEN pro_name IS NULL THEN
	           to_char(a.sum_weig / sum_suyul_wei2 * 100, '990D99')
	          ELSE
	           to_char(a.sum_weig / b.sum_weig * 100, '990D99')
	        END AS sum_rate
	  FROM (SELECT a.meat_type AS meat_type,
	               a.large_code AS large_code,
	               a.pro_name,
	               SUM(a.cur_weig) AS cur_weig,
	               SUM(a.cur_qty) AS cur_qty,
	               SUM(a.sum_weig) AS sum_weig,
	               SUM(a.sum_qty) AS sum_qty
	          FROM (SELECT b.meat_type AS meat_type,
	                       b.large_code AS large_code,
	                       b.pro_name,
	                       a.box_weig AS cur_weig,
	                       1 AS cur_qty,
	                       0 AS sum_weig,
	                       0 AS sum_qty
	                  FROM openmps.mp_bar_pro_m a, openmps.mp_item_master_m b
	                 WHERE 1 = 1
	                   AND a.corp_code = b.corp_code
	                   AND a.pro_code = b.pro_code
	                      
	                   AND a.dele_yn = 'N'
	                   AND a.prdt_type = '1'  
	                   AND a.corp_code = #corpCode#
	                   AND a.pro_date BETWEEN #junStrtDate# AND #junLastDateBe#  
	                   AND a.plant_code IN (SELECT plant_code
	                                          FROM openmps.tm_platxm a
	                                         WHERE a.grup_plant = #grupPlant#
	                                           AND a.prdt_type = '1'
	                                           AND a.corp_code = #corpCode#)
	                UNION ALL
	                SELECT b.meat_type AS meat_type,
	                       b.large_code AS large_code,
	                       b.pro_name,
	                       0 AS cur_weig,
	                       0 AS cur_qty,
	                       a.box_weig AS sum_weig,
	                       1 AS sum_qty
	                  FROM openmps.mp_bar_pro_m a, openmps.mp_item_master_m b
	                 WHERE 1 = 1
	                   AND a.corp_code = b.corp_code
	                   AND a.pro_code = b.pro_code
	                      
	                   AND a.dele_yn = 'N'
	                   AND a.prdt_type = '1'  
	                   AND a.corp_code = #corpCode#
	                   AND a.pro_date BETWEEN #dangStrtDateNo# AND #dangLastDateNo#  
							 AND a.plant_code IN (SELECT plant_code
	                                          FROM openmps.tm_platxm a
	                                         WHERE a.grup_plant = #grupPlant#
	                                           AND a.prdt_type = '1'
	                                           AND a.corp_code = #corpCode#)) AS a
	         GROUP BY (a.meat_type, a.large_code, pro_name)) AS a
	  LEFT JOIN (SELECT a.meat_type  AS meat_type,
	                    a.large_code AS large_code,
	                    
	                    SUM(a.cur_weig) AS cur_weig,
	                    SUM(a.cur_qty) AS cur_qty,
	                    SUM(a.sum_weig) AS sum_weig,
	                    SUM(a.sum_qty) AS sum_qty
	               FROM (SELECT b.meat_type  AS meat_type,
	                            b.large_code AS large_code,
	                            a.box_weig   AS cur_weig,
	                            1            AS cur_qty,
	                            0            AS sum_weig,
	                            0            AS sum_qty
	                       FROM openmps.mp_bar_pro_m a, openmps.mp_item_master_m b
	                      WHERE 1 = 1
	                        AND a.corp_code = b.corp_code
	                        AND a.pro_code = b.pro_code
	                           
	                        AND a.dele_yn = 'N'
	                        AND a.prdt_type = '1'  
	                        AND a.corp_code = #corpCode#
	                        AND a.pro_date BETWEEN #junStrtDate# AND #junLastDateBe#  
	                        AND a.plant_code IN
	                            (SELECT plant_code
	                               FROM openmps.tm_platxm a
	                              WHERE a.grup_plant = #grupPlant#
	                                AND a.prdt_type = '1'
	                                AND a.corp_code = #corpCode#)
	                     UNION ALL
	                     SELECT b.meat_type  AS meat_type,
	                            b.large_code AS large_code,
	                            0            AS cur_weig,
	                            0            AS cur_qty,
	                            a.box_weig   AS sum_weig,
	                            1            AS sum_qty
	                       FROM openmps.mp_bar_pro_m a, openmps.mp_item_master_m b
	                      WHERE 1 = 1
	                        AND a.corp_code = b.corp_code
	                        AND a.pro_code = b.pro_code
	                           
	                        AND a.dele_yn = 'N'
	                        AND a.prdt_type = '1'      
	                        AND a.corp_code = #corpCode#
	                        AND a.pro_date BETWEEN #dangStrtDateNo# AND #dangLastDateNo#  
									AND a.plant_code IN (SELECT plant_code
	                                               FROM openmps.tm_platxm a
	                                              WHERE a.grup_plant = #grupPlant#
	                                                AND a.prdt_type = '1'
	                                                AND a.corp_code = #corpCode#)) AS a
	              GROUP BY GROUPING SETS((a.meat_type, a.large_code),(a.meat_type))) AS b ON a.meat_type =
	                                                                                         b.meat_type
	                                                                                     AND a.large_code =
	                                                                                         b.large_code
	  LEFT JOIN openmps.tm_codexd d ON a.meat_type = d.code_id
	                              AND d.corp_code = #corpCode#
	                              AND d.group_code = 'MP010'
	  LEFT JOIN openmps.tm_codexd e ON a.large_code = e.code_id
	                              AND e.corp_code = #corpCode#
	                              AND e.group_code = 'MP006',
	 (SELECT SUM(suyul_wei2) AS cur_suyul_wei2,  
		      SUM(suyul_dusu) AS cur_suyul_dusu 
		 FROM openmps.mp_yield_info_m a
		WHERE a.corp_code = #corpCode#
		  AND a.work_date BETWEEN #junStrtDate# AND #junLastDateBe#  
		  AND a.grup_plant = #grupPlant#) AS f,
	 (SELECT SUM(suyul_wei2) AS sum_suyul_wei2,  
	         SUM(suyul_dusu) AS sum_suyul_dusu    
	    FROM openmps.mp_yield_info_m a
	   WHERE a.corp_code = #corpCode#
	     AND a.work_date BETWEEN #dangStrtDateNo# AND #dangLastDateNo# 
		  AND a.grup_plant = #grupPlant#) AS g
	 
	 ORDER BY 1, 2, 4, 6			
	]]>	
	</select>		
	<select id="PP0203mpYieldInfoMDAO.selectMpYieldInfoMListTotCnt_S" parameterClass="PP0203mpYieldInfoMSerarchVO" resultClass="int">
		SELECT 10
	</select>

</sqlMap>