<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="OpenapiPig">
	<resultMap id="OpenapiInfo" class="nds.mpm.prod.PP0801.vo.OpenapiCommonInfoVO">
		<result property="siteUrl" column="site_url" columnIndex="1"/>
		<result property="userId" column="user_id" columnIndex="2"/>
		<result property="apiKey" column="api_key" columnIndex="3"/>		
		<result property="typeCode" column="type_code" columnIndex="4"/>		
	</resultMap>
	
	<!-- 각각의 SQL 구문은 현실에 맞춰 수정해야 함 -->
	<!-- 매입실적 URL -->
	<select id="selectBuyInfo" resultMap="OpenapiInfo">
	<!--
		SELECT max(sub.user_id) user_id
		      ,max(sub.api_key) api_key
		      ,max(sub.site_url) site_url
		      ,'T' type_code
		 FROM (SELECT CASE WHEN a.code_name = '사용자계정' THEN
				        a.etc01
					  ELSE
						''
					  END user_id
					 ,CASE WHEN a.code_name = 'API KEY' THEN
				        a.etc01
					  ELSE
						''
					  END api_key
					 ,CASE WHEN a.code_name = '매입실적 API URL' THEN
				        a.etc01
					  ELSE
						''
					  END site_url
				  FROM tm_codexd a 
				 WHERE a.corp_code = '1001' 
				   AND a.group_code = 'PP009' 
				   AND a.code_name in ('사용자계정','API KEY','매입실적 API URL')) sub
	-->
	SELECT max( case when code_id = '1' then a.etc01 else '' end ) as user_id,
	max( case when code_id = '2' then a.etc01 else '' end ) as api_key,
	max( case when code_id = '3' then a.etc01 else '' end ) as site_url  
	,'T' type_code    
		  FROM tm_codexd a 
		 WHERE a.corp_code = '1001' 
		   AND a.group_code = 'PP009' 
	</select>
	
	<!-- 매출실적 URL -->
	<select id="selectSaleInfo" resultMap="OpenapiInfo">
	<!--  
		SELECT max(sub.user_id) user_id
		      ,max(sub.api_key) api_key
		      ,max(sub.site_url) site_url
		      ,'T' type_code
		 FROM (SELECT CASE WHEN a.code_name = '사용자계정' THEN
				        a.etc01
					  ELSE
						''
					  END user_id
					 ,CASE WHEN a.code_name = 'API KEY' THEN
				        a.etc01
					  ELSE
						''
					  END api_key
					 ,CASE WHEN a.code_name = '매출실적 API URL' THEN
				        a.etc01
					  ELSE
						''
					  END site_url
				  FROM tm_codexd a 
				 WHERE a.corp_code = '1001' 
				   AND a.group_code = 'PP009' 
				   AND a.code_name in ('사용자계정','API KEY','매출실적 API URL')) sub
	-->
	SELECT max( case when code_id = '1' then a.etc01 else '' end ) as user_id,
	max( case when code_id = '2' then a.etc01 else '' end ) as api_key,
	max( case when code_id = '4' then a.etc01 else '' end ) as site_url  
	,'T' type_code    
		  FROM tm_codexd a 
		 WHERE a.corp_code = '1001' 
		   AND a.group_code = 'PP009' 
	</select>
	
	<!-- 포장실적 URL -->
	<select id="selectPackInfo" resultMap="OpenapiInfo">
	<!--
		SELECT max(sub.user_id) user_id
		      ,max(sub.api_key) api_key
		      ,max(sub.site_url) site_url
		      ,'' type_code
		 FROM (SELECT CASE WHEN a.code_name = '사용자계정' THEN
				        a.etc01
					  ELSE
						''
					  END user_id
					 ,CASE WHEN a.code_name = 'API KEY' THEN
				        a.etc01
					  ELSE
						''
					  END api_key
					 ,CASE WHEN a.code_name = '포장실적 API URL' THEN
				        a.etc01
					  ELSE
						''
					  END site_url
				  FROM tm_codexd a 
				 WHERE a.corp_code = '1001' 
				   AND a.group_code = 'PP009' 
				   AND a.code_name in ('사용자계정','API KEY','포장실적 API URL')) sub
	-->
	SELECT max( case when code_id = '1' then a.etc01 else '' end ) as user_id,
	max( case when code_id = '2' then a.etc01 else '' end ) as api_key,
	max( case when code_id = '5' then a.etc01 else '' end ) as site_url  
	,'' type_code    
		  FROM tm_codexd a 
		 WHERE a.corp_code = '1001' 
		   AND a.group_code = 'PP009' 
	</select>
	
	<!-- Table Data 테스트를 위해 추가함. -->
	<!-- 개발시 제외시켜야 함 -->
	<resultMap id="MpPigHisBuy" class="nds.mpm.prod.PP0801.vo.MpPighisBuyVO">
		<result property="corp_code" column="corp_code" columnIndex="1"/>
		<result property="buy_date" column="buy_date" columnIndex="2"/>
		<result property="his_no" column="his_no" columnIndex="3"/>
		<result property="doch_no" column="doch_no" columnIndex="4"/>
		<result property="sum_weig" column="sum_weig" columnIndex="5"/>
		<result property="grade_gubun1" column="grade_gubun1" columnIndex="6"/>
		<result property="grade_gubun2" column="grade_gubun2" columnIndex="7"/>
		<result property="buy_type" column="buy_type" columnIndex="8"/>
		<result property="base_part_code" column="base_part_code" columnIndex="9"/>
		<result property="base_part_name" column="base_part_name" columnIndex="10"/>
		<result property="comp_ssno" column="comp_ssno" columnIndex="11"/>
		<result property="comp_name" column="comp_name" columnIndex="12"/>
		<result property="comp_owner" column="comp_owner" columnIndex="13"/>
		<result property="comp_tel" column="comp_tel" columnIndex="14"/>
		<result property="comp_addr" column="comp_addr" columnIndex="15"/>
		<result property="cust_name" column="cust_name" columnIndex="16"/>
		<result property="gita_pan" column="gita_pan" columnIndex="17"/>
		<result property="gita_type" column="gita_type" columnIndex="18"/>
		<result property="gita_sex" column="gita_sex" columnIndex="19"/>
		<result property="gita_weig" column="gita_weig" columnIndex="20"/>
		<result property="gita_fat_thick" column="gita_fat_thick" columnIndex="21"/>
		<result property="api_time" column="api_time" columnIndex="22"/>
		<result property="memo" column="memo" columnIndex="23"/>
		<result property="dele_yn" column="dele_yn" columnIndex="24"/>
		<result property="md_user" column="md_user" columnIndex="25"/>
		<result property="md_date" column="md_date" columnIndex="26"/>
		<result property="cr_user" column="cr_user" columnIndex="27"/>
		<result property="cr_date" column="cr_date" columnIndex="28"/>
	</resultMap>
	<select id="selectPigHisBuy" resultMap="MpPigHisBuy">
	<![CDATA[
		select * 
		  From mp_pighis_buy_m a 
		 where his_no = '110034100352' and doch_no = '1881'
		 limit 1
	]]>
	</select>
	
	<resultMap id="MpPigHisPack" class="nds.mpm.prod.PP0802.vo.MpPighisPackVO">
		<result property="corp_code" column="corp_code" columnIndex="1"/>
		<result property="pack_date" column="pack_date" columnIndex="2"/>
		<result property="bunch_no" column="bunch_no" columnIndex="3"/>
		<result property="base_part_code" column="base_part_code" columnIndex="4"/>
		<result property="base_part_name" column="base_part_name" columnIndex="5"/>
		<result property="pack_weig" column="pack_weig" columnIndex="6"/>
		<result property="memo" column="memo" columnIndex="7"/>
		<result property="api_time" column="api_time" columnIndex="8"/>
		<result property="dele_yn" column="dele_yn" columnIndex="9"/>
		<result property="md_user" column="md_user" columnIndex="10"/>
		<result property="md_date" column="md_date" columnIndex="11"/>
		<result property="cr_user" column="cr_user" columnIndex="12"/>
		<result property="cr_date" column="cr_date" columnIndex="13"/>
	</resultMap>
	<select id="selectPigHisPack" resultMap="MpPigHisPack">
	<![CDATA[
		select * From mp_pighis_pack_m a where a.pack_date='20170828'
	]]>
	</select>
	
	<resultMap id="MpPigHisSale" class="nds.mpm.prod.PP0803.vo.MpPighisSaleVO">
		<result property="corp_code" column="corp_code" columnIndex="1"/>
		<result property="out_code" column="out_code" columnIndex="2"/>
		<result property="sale_date" column="sale_date" columnIndex="3"/>
		<result property="his_bunch_no" column="his_bunch_no" columnIndex="4"/>
		<result property="cust_code" column="cust_code" columnIndex="5"/>
		<result property="cust_name" column="cust_name" columnIndex="6"/>
		<result property="cust_regno" column="cust_regno" columnIndex="7"/>
		<result property="cust_owner" column="cust_owner" columnIndex="8"/>
		<result property="cust_phone" column="cust_phone" columnIndex="9"/>
		<result property="cust_addr" column="cust_addr" columnIndex="10"/>
		<result property="no_gubun" column="no_gubun" columnIndex="11"/>
		<result property="base_part_code" column="base_part_code" columnIndex="12"/>
		<result property="base_part_name" column="base_part_name" columnIndex="13"/>
		<result property="sale_weig" column="sale_weig" columnIndex="14"/>
		<result property="sale_qty" column="sale_qty" columnIndex="15"/>
		<result property="lc_yn" column="lc_yn" columnIndex="16"/>
		<result property="memo" column="memo" columnIndex="17"/>
		<result property="api_time" column="api_time" columnIndex="18"/>
		<result property="dele_yn" column="dele_yn" columnIndex="19"/>
		<result property="md_user" column="md_user" columnIndex="20"/>
		<result property="md_date" column="md_date" columnIndex="21"/>
		<result property="cr_user" column="cr_user" columnIndex="22"/>
		<result property="cr_date" column="cr_date" columnIndex="23"/>
		<result property="gagong_no" column="gagong_no" columnIndex="24"/>
	</resultMap>
	<select id="selectPigHisSale" resultMap="MpPigHisSale">
	<![CDATA[
		select * From mp_pighis_sale_m a where a.sale_date='20170828' and a.his_bunch_no in ('149005200485','140149700078') order by a.sale_weig
	]]>
	</select>
</sqlMap>