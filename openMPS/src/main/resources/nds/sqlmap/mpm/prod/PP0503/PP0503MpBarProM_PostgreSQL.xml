<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="PP0503MpBarProM">
	
	<typeAlias  alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
	<typeAlias  alias="PP0503mpBarProMSerarchVO" type="nds.mpm.prod.PP0504.vo.MpBarProMVO"/>
	
	<!-- <resultMap id="mpBarProM" class="nds.mpm.prod.PP0503.vo.MpBarProMVO">
		<result property="corpCode" column="corp_code" columnIndex="1"/>
		<result property="plantCode" column="plant_code" columnIndex="2"/>
		<result property="barCode" column="bar_code" columnIndex="3"/>
		<result property="proDate" column="pro_date" columnIndex="4"/>
		<result property="proTime" column="pro_time" columnIndex="5"/>
		<result property="proCode" column="pro_code" columnIndex="6"/>
		<result property="suCode" column="su_code" columnIndex="7"/>
		<result property="nongCode" column="nong_code" columnIndex="8"/>
		<result property="boxWeig" column="box_weig" columnIndex="9"/>
		<result property="cartonNo" column="carton_no" columnIndex="10"/>
		<result property="dochDate" column="doch_date" columnIndex="11"/>
		<result property="pojangji" column="pojangji" columnIndex="12"/>
		<result property="shelfLife" column="shelf_life" columnIndex="13"/>
		<result property="manufacturer" column="manufacturer" columnIndex="14"/>
		<result property="slaughterhouse" column="slaughterhouse" columnIndex="15"/>
		<result property="temperature" column="temperature" columnIndex="16"/>
		<result property="bunchNo" column="bunch_no" columnIndex="17"/>
		<result property="prdtType" column="prdt_type" columnIndex="18"/>
		<result property="wmsYn" column="wms_yn" columnIndex="19"/>
		<result property="memo" column="memo" columnIndex="20"/>
		<result property="deleYn" column="dele_yn" columnIndex="21"/>
		<result property="mdUser" column="md_user" columnIndex="22"/>
		<result property="mdDate" column="md_date" columnIndex="23"/>
		<result property="crUser" column="cr_user" columnIndex="24"/>
		<result property="crDate" column="cr_date" columnIndex="25"/>
	</resultMap>
	
	<insert id="mpBarProMDAO.insertMpBarProM_S">
		<![CDATA[
			INSERT INTO mp_bar_pro_m 
				( corp_code
				  , plant_code
				  , bar_code
				  , pro_date
				  , pro_time
				  , pro_code
				  , su_code
				  , nong_code
				  , box_weig
				  , carton_no
				  , doch_date
				  , pojangji
				  , shelf_life
				  , manufacturer
				  , slaughterhouse
				  , temperature
				  , bunch_no
				  , prdt_type
				  , wms_yn
				  , memo
				  , dele_yn
				  , md_user
				  , md_date
				  , cr_user
				  , cr_date )
			VALUES ( #corpCode#
				  , #plantCode#
				  , #barCode#
				  , #proDate#
				  , #proTime#
				  , #proCode#
				  , #suCode#
				  , #nongCode#
				  , #boxWeig#
				  , #cartonNo#
				  , #dochDate#
				  , #pojangji#
				  , #shelfLife#
				  , #manufacturer#
				  , #slaughterhouse#
				  , #temperature#
				  , #bunchNo#
				  , #prdtType#
				  , #wmsYn#
				  , #memo#
				  , #deleYn#
				  , #mdUser#
				  , #mdDate#
				  , #crUser#
				  , #crDate# )
		]]>
	</insert>
	
	<update id="mpBarProMDAO.updateMpBarProM_S">
		<![CDATA[
			UPDATE mp_bar_pro_m
			SET corp_code=#corpCode#
				, plant_code=#plantCode#
				, bar_code=#barCode#
				, pro_date=#proDate#
				, pro_time=#proTime#
				, pro_code=#proCode#
				, su_code=#suCode#
				, nong_code=#nongCode#
				, box_weig=#boxWeig#
				, carton_no=#cartonNo#
				, doch_date=#dochDate#
				, pojangji=#pojangji#
				, shelf_life=#shelfLife#
				, manufacturer=#manufacturer#
				, slaughterhouse=#slaughterhouse#
				, temperature=#temperature#
				, bunch_no=#bunchNo#
				, prdt_type=#prdtType#
				, wms_yn=#wmsYn#
				, memo=#memo#
				, dele_yn=#deleYn#
				, md_user=#mdUser#
				, md_date=#mdDate#
				, cr_user=#crUser#
				, cr_date=#crDate#
						WHERE corp_code=#corpCode#
								AND plant_code=#plantCode#
								AND bar_code=#barCode#
				]]>
	</update>
	
	<delete id="mpBarProMDAO.deleteMpBarProM_S">
		<![CDATA[
			DELETE FROM mp_bar_pro_m 
						WHERE corp_code=#corpCode#
								AND plant_code=#plantCode#
								AND bar_code=#barCode#
				]]>
	</delete>
	
	<select id="mpBarProMDAO.selectMpBarProM_S" resultMap="mpBarProM">
		<![CDATA[
			SELECT
				corp_code
				, plant_code
				, bar_code
				, pro_date
				, pro_time
				, pro_code
				, su_code
				, nong_code
				, box_weig
				, carton_no
				, doch_date
				, pojangji
				, shelf_life
				, manufacturer
				, slaughterhouse
				, temperature
				, bunch_no
				, prdt_type
				, wms_yn
				, memo
				, dele_yn
				, md_user
				, md_date
				, cr_user
				, cr_date
			FROM mp_bar_pro_m
						WHERE corp_code=#corpCode#
								AND plant_code=#plantCode#
								AND bar_code=#barCode#
				]]>
	</select> -->
		
	<!-- <select id="PP0503mpBarProMDAO.selectMpBarProMList_D" parameterClass="PP0503mpBarProMSerarchVO" resultClass="egovMap">
		SELECT
			corp_code
			, pro_code
			, bar_code
			, '08:35:02' as barinTime
			, 'O' as proYn
			, 'X' as dcYn
				FROM mp_bar_pro_m
				LIMIT 10
	</select>	 -->
	
	<select id="PP0503mpBarProMDAO.selectMpBarProMList_D" parameterClass="PP0503mpBarProMSerarchVO" resultClass="egovMap">
	<![CDATA[
	SELECT a.pro_code,
	       b.pro_name,
	       b.pro_ukind,
	       SUM(box_qty) AS prod_qty,
	       SUM(box_weig) AS prod_weig,
	       SUM(wms_qty) AS wms_qty,
	       SUM(wms_weig) AS wms_weig,
	       SUM(wms_qty) - SUM(box_qty) AS diff_qty
	  FROM (SELECT a.pro_code,
	               COUNT(*) AS box_qty,
	               SUM(box_weig) AS box_weig,
	               0 AS wms_qty,
	               0 AS wms_weig
	          FROM openmps.mp_bar_pro_m a
	         WHERE 1 = 1
	           AND a.dele_yn = 'N'
	           AND a.corp_code = #corpCode#
	           AND a.plant_code = #plantCode#
	           AND a.prdt_type IN ('1', '2')
	           AND pro_date = #strtDate#
	         GROUP BY a.pro_code
	        UNION ALL
	        SELECT b.pro_code,
	               COUNT(*) AS qty,
	               SUM(b.pro_weig) AS box_weig,
	               0 AS wms_qty,
	               0 AS wms_weig
	          FROM openmps.mp_auto_total_m a, openmps.mp_item_master_m b
	         WHERE 1 = 1
	           AND a.dele_yn = 'N'
	           AND a.corp_code = #corpCode#
	           AND a.plant_code = #plantCode# 
	           AND a.work_date = #strtDate# 
	           AND a.pro_name = b.pro_name
	         GROUP BY b.pro_code
	        UNION ALL
	        SELECT b.sku, 0, 0, b.rcptqty, b.wt
	          FROM openmps.rc_rcpthd a, openmps.rc_rcptdt b
	         WHERE a.client = #corpCode# 
	           AND a.spcust = #plantCode#
	           AND a.rcptde = #strtDate# 
	           AND a.rcpttp = 'R11'
	           AND a.stat = '50'
	           AND a.rcptno = b.rcptno
	           AND a.dc = b.dc
	           AND a.biz = b.biz
	           AND b.stat = '50') a,
	       openmps.mp_item_master_m b
	 WHERE a.pro_code = b.pro_code
	 GROUP BY a.pro_code, b.pro_name, b.pro_ukind
	 ORDER BY a.pro_code, b.pro_name, b.pro_ukind
	]]>	
	</select>	
	
	<select id="PP0503mpBarProMDAO.selectMpBarProMListTotCnt_S" parameterClass="PP0503mpBarProMSerarchVO" resultClass="int">
	<![CDATA[
	SELECT COUNT(*)
	  FROM (SELECT a.pro_code,
	    	       b.pro_name,
	    	       b.pro_ukind,
	    	       SUM(box_qty) AS prod_qty,
	    	       SUM(box_weig) AS prod_weig,
	    	       SUM(wms_qty) AS wms_qty,
	    	       SUM(wms_weig) AS wms_weig,
	    	       SUM(wms_qty) - SUM(box_qty) AS diff_qty
	    	  FROM (SELECT a.pro_code,
	    	               COUNT(*) AS box_qty,
	    	               SUM(box_weig) AS box_weig,
	    	               0 AS wms_qty,
	    	               0 AS wms_weig
	    	          FROM openmps.mp_bar_pro_m a
	    	         WHERE 1 = 1
	    	           AND a.dele_yn = 'N'
	    	           AND a.corp_code = #corpCode#
	    	           AND a.plant_code = #plantCode#
	    	           AND a.prdt_type IN ('1', '2')
	    	           AND pro_date = #strtDate#
	    	         GROUP BY a.pro_code
	    	        UNION ALL
	    	        SELECT b.pro_code,
	    	               COUNT(*) AS qty,
	    	               SUM(b.pro_weig) AS box_weig,
	    	               0 AS wms_qty,
	    	               0 AS wms_weig
	    	          FROM openmps.mp_auto_total_m a, openmps.mp_item_master_m b
	    	         WHERE 1 = 1
	    	           AND a.dele_yn = 'N'
	    	           AND a.corp_code = #corpCode#
	    	           AND a.plant_code = #plantCode# 
	    	           AND a.work_date = #strtDate# 
	    	           AND a.pro_name = b.pro_name
	    	         GROUP BY b.pro_code
	    	        UNION ALL
	    	        SELECT b.sku, 0, 0, b.rcptqty, b.wt
	    	          FROM openmps.rc_rcpthd a, openmps.rc_rcptdt b
	    	         WHERE a.client = #corpCode# 
	    	           AND a.spcust = #plantCode#
	    	           AND a.rcptde = #strtDate# 
	    	           AND a.rcpttp = 'R11'
	    	           AND a.stat = '50'
	    	           AND a.rcptno = b.rcptno
	    	           AND a.dc = b.dc
	    	           AND a.biz = b.biz
	    	           AND b.stat = '50') a,
	    	       openmps.mp_item_master_m b
	    	 WHERE a.pro_code = b.pro_code
	    	 GROUP BY a.pro_code, b.pro_name, b.pro_ukind) a
	]]>
	</select>
	
	<select id="PP0503mpBarProMDAO.selectPopMpBarProMList_D" parameterClass="PP0503mpBarProMSerarchVO" resultClass="egovMap">
	<![CDATA[
	SELECT a.bar_code,
	       MAX(a.pro_time) AS pro_time,
	       CASE
	          WHEN MAX(a.prod) = '*' THEN
	           'O'
	          ELSE
	           'X'
	        END AS prod,
	       CASE
	          WHEN MAX(a.wms) = '*' THEN
	           'O'
	          ELSE
	           'X'
	        END AS wms
	  FROM (SELECT a.bar_code, a.pro_time, '*' AS prod, '' AS wms
	          FROM openmps.mp_bar_pro_m a
	         WHERE 1 = 1
	           AND a.dele_yn = 'N'
	           AND a.corp_code = #corpCode#
	           AND a.plant_code = #plantCode#
	           AND a.prdt_type IN ('1', '2')           
	           AND pro_date = #strtDate#
	           AND a.pro_code = #proCode#
	        UNION ALL
		     SELECT '*', /* a.print_code, */ 
		            '',  /* substr(a.print_code, 9, 2) || ':' || substr(a.print_code, 11, 2) || ':' || substr(a.print_code, 13, 2) AS pro_time, */
                    '*' AS prod, '' AS wms
			    FROM openmps.mp_auto_total_m a, openmps.mp_item_master_m b
			   WHERE 1 = 1
			     AND a.dele_yn = 'N'
			     AND a.corp_code = #corpCode#
			     AND a.plant_code = #plantCode# 
			     AND a.work_date = #strtDate# 
			     AND a.pro_name = b.pro_name 
			     AND b.pro_code = #proCode#           
	        UNION ALL
	        SELECT c.caseid, '', '', '*'
	          FROM openmps.rc_rcpthd a, openmps.rc_rcptdt b, openmps.rc_rcptasgn c
	         WHERE a.client = #corpCode#
	           AND a.spcust = #plantCode#
	           AND a.rcptde = #strtDate#
	           AND a.rcpttp = 'R11'
	           AND b.sku = #proCode#
	           AND a.stat = '50'
	           AND a.rcptno = b.rcptno
	           AND a.dc = b.dc
	           AND a.biz = b.biz
	           AND b.stat = '50'
	           AND a.rcptno = c.rcptno
	           AND b.rcptsn = c.rcptsn
	           AND a.dc = c.dc
	           AND a.biz = c.biz
	           AND c.stat = '50') a
	 GROUP BY a.bar_code
	 ORDER BY a.bar_code
	]]>	
	</select>	

</sqlMap>
